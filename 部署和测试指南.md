# æ™ºæ…§èåª’ä½“ç»ˆç«¯ Android App éƒ¨ç½²æŒ‡å—

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æ‚¨å·²æˆåŠŸä¸ºAndroid 4.4è®¾å¤‡åˆ›å»ºäº†ä¸€ä¸ªå®Œæ•´çš„MQTTå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œç”¨äºä¸æ™ºæ…§èåª’ä½“äº‘å¹³å°è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚

## ğŸ“‚ é¡¹ç›®ç»“æ„æ¦‚è§ˆ

```
MediaProgramAndroid/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ src/main/java/com/sakurapainting/mediaprogramandroid/
â”‚   â”‚   â”œâ”€â”€ MediaApplication.java         # åº”ç”¨ç¨‹åºä¸»ç±»
â”‚   â”‚   â”œâ”€â”€ MainActivity.java             # ä¸»ç•Œé¢æ´»åŠ¨
â”‚   â”‚   â”œâ”€â”€ MqttManager.java             # MQTTè¿æ¥ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ DeviceStatusManager.java     # è®¾å¤‡çŠ¶æ€ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ ContentManager.java          # å†…å®¹ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ ContentDisplayActivity.java  # å†…å®¹æ˜¾ç¤ºæ´»åŠ¨
â”‚   â”‚   â””â”€â”€ ConfigManager.java           # é…ç½®ç®¡ç†å™¨
â”‚   â”œâ”€â”€ src/main/res/                    # åº”ç”¨èµ„æºæ–‡ä»¶
â”‚   â””â”€â”€ build/outputs/apk/debug/         # ç”Ÿæˆçš„APKæ–‡ä»¶
â”œâ”€â”€ README.md                            # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ build_app.bat                       # Windowsæ„å»ºè„šæœ¬
â”œâ”€â”€ test_android_app.sh                 # Linux/Macæµ‹è¯•è„šæœ¬
â””â”€â”€ éƒ¨ç½²å’Œæµ‹è¯•æŒ‡å—.md                    # æœ¬æ–‡æ¡£
```

## ğŸ‰ å·²å®ç°çš„æ ¸å¿ƒåŠŸèƒ½

### 1. MQTTé€šä¿¡åŠŸèƒ½
- âœ… **è‡ªåŠ¨è¿æ¥**: åº”ç”¨å¯åŠ¨åè‡ªåŠ¨è¿æ¥åˆ°MQTTæœåŠ¡å™¨
- âœ… **è®¾å¤‡æ³¨å†Œ**: è‡ªåŠ¨ç”Ÿæˆè®¾å¤‡IDå¹¶æ³¨å†Œåˆ°äº‘å¹³å°
- âœ… **å¿ƒè·³æœºåˆ¶**: æ¯30ç§’å‘é€è®¾å¤‡çŠ¶æ€å¿ƒè·³
- âœ… **è‡ªåŠ¨é‡è¿**: ç½‘ç»œæ–­å¼€åè‡ªåŠ¨é‡è¿
- âœ… **æ¶ˆæ¯è®¢é˜…**: è®¢é˜…å†…å®¹æ¨é€ã€å‘½ä»¤å’Œå¹¿æ’­ä¸»é¢˜

### 2. å†…å®¹æ˜¾ç¤ºåŠŸèƒ½
- âœ… **å›¾ç‰‡æ˜¾ç¤º**: æ”¯æŒç½‘ç»œå›¾ç‰‡å…¨å±æ˜¾ç¤º
- âœ… **è§†é¢‘æ’­æ”¾**: æ”¯æŒç½‘ç»œè§†é¢‘æ’­æ”¾
- âœ… **æ–‡æœ¬å±•ç¤º**: æ”¯æŒæ ‡é¢˜å’Œæ­£æ–‡æ–‡æœ¬æ˜¾ç¤º
- âœ… **ç½‘é¡µæµè§ˆ**: æ”¯æŒç½‘é¡µå†…å®¹å±•ç¤º
- âœ… **è‡ªåŠ¨æ—¶é•¿æ§åˆ¶**: æŒ‰ç…§è®¾å®šæ—¶é—´è‡ªåŠ¨åˆ‡æ¢å†…å®¹

### 3. è®¾å¤‡ç®¡ç†åŠŸèƒ½
- âœ… **çŠ¶æ€ç›‘æ§**: å®æ—¶æ”¶é›†CPUã€å†…å­˜ã€æ¸©åº¦ç­‰ä¿¡æ¯
- âœ… **è¿œç¨‹å‘½ä»¤**: æ”¯æŒé‡å¯ã€æˆªå›¾ã€çŠ¶æ€æŸ¥è¯¢ç­‰å‘½ä»¤
- âœ… **å¹¿æ’­æ¥æ”¶**: æ¥æ”¶ç³»ç»Ÿå¹¿æ’­æ¶ˆæ¯
- âœ… **è®¾å¤‡ä¿¡æ¯ä¸ŠæŠ¥**: è‡ªåŠ¨ä¸ŠæŠ¥è®¾å¤‡è§„æ ¼å’ŒçŠ¶æ€

### 4. ç”¨æˆ·ç•Œé¢
- âœ… **ä¸»æ§åˆ¶ç•Œé¢**: æ˜¾ç¤ºè¿æ¥çŠ¶æ€å’Œè®¾å¤‡ä¿¡æ¯
- âœ… **æƒé™ç®¡ç†**: è‡ªåŠ¨è¯·æ±‚å¿…è¦çš„ç³»ç»Ÿæƒé™
- âœ… **è¿æ¥æ§åˆ¶**: æ‰‹åŠ¨è¿æ¥/æ–­å¼€MQTTæœåŠ¡
- âœ… **çŠ¶æ€æŒ‡ç¤º**: å®æ—¶æ˜¾ç¤ºç³»ç»Ÿè¿è¡ŒçŠ¶æ€

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1: å‡†å¤‡å¼€å‘ç¯å¢ƒ
```bash
# 1. ç¡®ä¿å·²å®‰è£…Android SDKå’ŒJava Development Kit
# 2. è®¾ç½®ANDROID_HOMEç¯å¢ƒå˜é‡
# 3. è¿æ¥Androidè®¾å¤‡æˆ–å¯åŠ¨æ¨¡æ‹Ÿå™¨
```

### æ­¥éª¤2: æ„å»ºåº”ç”¨
```batch
# Windowsç¯å¢ƒ
cd d:\Harine_internship\code\MediaProgramAndroid
.\build_app.bat

# æˆ–ä½¿ç”¨Gradleå‘½ä»¤
.\gradlew clean assembleDebug
```

### æ­¥éª¤3: å®‰è£…åˆ°è®¾å¤‡
```bash
# 1. å¯ç”¨USBè°ƒè¯•æ¨¡å¼
# 2. è¿æ¥Androidè®¾å¤‡åˆ°ç”µè„‘
# 3. å®‰è£…APK
adb install -r app\build\outputs\apk\debug\app-debug.apk

# 4. å¯åŠ¨åº”ç”¨
adb shell am start -n com.sakurapainting.mediaprogramandroid/.MainActivity
```

### æ­¥éª¤4: é…ç½®ç½‘ç»œè¿æ¥
```java
// å¯¹äºå®é™…è®¾å¤‡éƒ¨ç½²ï¼Œéœ€è¦ä¿®æ”¹æœåŠ¡å™¨åœ°å€
// åœ¨ConfigManager.javaä¸­ä¿®æ”¹ï¼š
private static final String DEFAULT_MQTT_SERVER = "192.168.1.100"; // æ”¹ä¸ºå®é™…æœåŠ¡å™¨IP
```

## ğŸ§ª åŠŸèƒ½æµ‹è¯•

### æµ‹è¯•1: MQTTè¿æ¥æµ‹è¯•
1. å¯åŠ¨åº”ç”¨
2. è§‚å¯Ÿä¸»ç•Œé¢è¿æ¥çŠ¶æ€
3. ç¡®è®¤è®¾å¤‡IDå’Œå®¢æˆ·ç«¯IDæ­£ç¡®ç”Ÿæˆ
4. éªŒè¯"è¿æ¥MQTT"æŒ‰é’®åŠŸèƒ½

### æµ‹è¯•2: å†…å®¹æ¨é€æµ‹è¯•
ä½¿ç”¨äº‘å¹³å°APIæˆ–æµ‹è¯•è„šæœ¬æ¨é€å†…å®¹ï¼š

```bash
# æ¨é€å›¾ç‰‡å†…å®¹
curl -X POST http://your-server:5001/api/mqtt/push \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "deviceId": "android_001",
    "contentId": "test_image",
    "url": "https://picsum.photos/800/600",
    "type": "image",
    "duration": 10
  }'

# æ¨é€æ–‡æœ¬å†…å®¹
curl -X POST http://your-server:5001/api/mqtt/push \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "deviceId": "android_001", 
    "contentId": "test_text",
    "type": "text",
    "duration": 8,
    "data": {
      "title": "æµ‹è¯•æ ‡é¢˜",
      "text": "è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯"
    }
  }'
```

### æµ‹è¯•3: å‘½ä»¤ä¸‹å‘æµ‹è¯•
```bash
# å‘é€çŠ¶æ€æŸ¥è¯¢å‘½ä»¤
curl -X POST http://your-server:5001/api/mqtt/command \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "deviceId": "android_001",
    "command": "get_status"
  }'

# å‘é€é‡å¯å‘½ä»¤
curl -X POST http://your-server:5001/api/mqtt/command \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "deviceId": "android_001",
    "command": "restart"
  }'
```

### æµ‹è¯•4: å¹¿æ’­æ¶ˆæ¯æµ‹è¯•
```bash
# å‘é€å¹¿æ’­æ¶ˆæ¯
curl -X POST http://your-server:5001/api/mqtt/broadcast \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "message": "ç³»ç»Ÿç»´æŠ¤é€šçŸ¥ï¼šå°†åœ¨30åˆ†é’Ÿåè¿›è¡Œç³»ç»Ÿå‡çº§",
    "level": "warning"
  }'
```

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### å®æ—¶æ—¥å¿—ç›‘æ§
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
adb logcat | grep "MediaProgram"

# æŸ¥çœ‹MQTTç›¸å…³æ—¥å¿—
adb logcat | grep "MqttManager"

# æŸ¥çœ‹å†…å®¹æ˜¾ç¤ºæ—¥å¿—
adb logcat | grep "ContentDisplay"

# æŸ¥çœ‹è®¾å¤‡çŠ¶æ€æ—¥å¿—
adb logcat | grep "DeviceStatus"
```

### çŠ¶æ€æ£€æŸ¥å‘½ä»¤
```bash
# æ£€æŸ¥åº”ç”¨æ˜¯å¦è¿è¡Œ
adb shell ps | grep mediaprogramandroid

# æ£€æŸ¥ç½‘ç»œè¿æ¥
adb shell ping your-server-ip

# æ£€æŸ¥è®¾å¤‡å­˜å‚¨ç©ºé—´
adb shell df

# æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ
adb shell dumpsys meminfo com.sakurapainting.mediaprogramandroid
```

## ğŸ”§ é…ç½®è°ƒä¼˜

### ç½‘ç»œé…ç½®ä¼˜åŒ–
```java
// åœ¨ConfigManagerä¸­è°ƒæ•´å‚æ•°
public static final int DEFAULT_HEARTBEAT_INTERVAL = 30; // å¿ƒè·³é—´éš”(ç§’)
public static final int DEFAULT_RECONNECT_DELAY = 5;     // é‡è¿å»¶è¿Ÿ(ç§’)
```

### å†…å­˜ä½¿ç”¨ä¼˜åŒ–
```java
// åœ¨ContentDisplayActivityä¸­ä¼˜åŒ–
- åŠæ—¶é‡Šæ”¾Bitmapèµ„æº
- æ§åˆ¶WebViewå†…å­˜ä½¿ç”¨
- ä¼˜åŒ–è§†é¢‘æ’­æ”¾ç¼“å­˜
```

### ç”µæ± ä½¿ç”¨ä¼˜åŒ–
```java
// åœ¨MqttManagerä¸­ä¼˜åŒ–
- è°ƒæ•´å¿ƒè·³é¢‘ç‡
- ç½‘ç»œæ–­å¼€æ—¶å‡å°‘é‡è¯•
- å±å¹•å…³é—­æ—¶é™ä½æ´»åŠ¨
```

## ğŸ”’ å®‰å…¨é…ç½®

### æƒé™æœ€å°åŒ–
```xml
<!-- ä»…ä¿ç•™å¿…è¦æƒé™ï¼Œç§»é™¤ä¸éœ€è¦çš„æƒé™ -->
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
<uses-permission android:name="android.permission.WAKE_LOCK" />
```

### ç½‘ç»œå®‰å…¨
```java
// ç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨SSL/TLS
private static final String MQTT_SERVER_URL = "ssl://your-server:8883";

// éªŒè¯æœåŠ¡å™¨è¯ä¹¦
MqttConnectOptions options = new MqttConnectOptions();
options.setSocketFactory(sslSocketFactory);
```

## ğŸ“± ç”Ÿäº§éƒ¨ç½²å»ºè®®

### 1. è®¾å¤‡é…ç½®
- ç¡®ä¿Android 4.4+ç³»ç»Ÿ
- é…ç½®å›ºå®šIPæˆ–å¯é WiFiè¿æ¥
- è®¾ç½®è‡ªåŠ¨å¯åŠ¨åº”ç”¨
- é…ç½®è®¾å¤‡ä¸è¿›å…¥ä¼‘çœ æ¨¡å¼

### 2. åº”ç”¨é…ç½®
- ä¿®æ”¹æœåŠ¡å™¨åœ°å€ä¸ºç”Ÿäº§ç¯å¢ƒIP
- è°ƒæ•´å¿ƒè·³é—´éš”é€‚åº”ç½‘ç»œç¯å¢ƒ
- å¯ç”¨æ—¥å¿—è®°å½•ä¾¿äºæ•…éšœæ’æŸ¥
- é…ç½®åº”ç”¨è‡ªåŠ¨æ›´æ–°æœºåˆ¶

### 3. æœåŠ¡å™¨é…ç½®
- ç¡®ä¿MQTTæœåŠ¡å™¨ç¨³å®šè¿è¡Œ
- é…ç½®è®¾å¤‡ç™½åå•å’Œè®¤è¯
- ç›‘æ§è®¾å¤‡è¿æ¥çŠ¶æ€
- å»ºç«‹æ•…éšœå‘Šè­¦æœºåˆ¶

### 4. ç›‘æ§ç»´æŠ¤
- å®šæœŸæ£€æŸ¥è®¾å¤‡åœ¨çº¿çŠ¶æ€
- ç›‘æ§å†…å®¹æ¨é€æˆåŠŸç‡
- è®°å½•è®¾å¤‡æ€§èƒ½æ•°æ®
- å»ºç«‹è¿œç¨‹ç»´æŠ¤æœºåˆ¶

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

1. **MQTTè¿æ¥å¤±è´¥**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
   - ç¡®è®¤æœåŠ¡å™¨IPåœ°å€å’Œç«¯å£æ­£ç¡®
   - éªŒè¯é˜²ç«å¢™è®¾ç½®
   - æŸ¥çœ‹æœåŠ¡å™¨MQTTæœåŠ¡æ˜¯å¦è¿è¡Œ

2. **æƒé™è¢«æ‹’ç»**
   - åœ¨è®¾å¤‡è®¾ç½®ä¸­æ‰‹åŠ¨æˆäºˆæƒé™
   - é‡å¯åº”ç”¨é‡æ–°è¯·æ±‚æƒé™
   - æ£€æŸ¥targetSdkVersionè®¾ç½®

3. **å†…å®¹æ˜¾ç¤ºå¼‚å¸¸**
   - éªŒè¯å†…å®¹URLæ˜¯å¦å¯è®¿é—®
   - æ£€æŸ¥ç½‘ç»œå¸¦å®½æ˜¯å¦è¶³å¤Ÿ
   - ç¡®è®¤è®¾å¤‡æ”¯æŒå†…å®¹æ ¼å¼
   - æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ

4. **åº”ç”¨å´©æºƒ**
   - æŸ¥çœ‹logcatæ—¥å¿—æ‰¾å‡ºå…·ä½“é”™è¯¯
   - æ£€æŸ¥å†…å­˜ä½¿ç”¨æ˜¯å¦è¶…é™
   - éªŒè¯ç½‘ç»œè¿æ¥ç¨³å®šæ€§
   - é‡å¯è®¾å¤‡æ¸…ç†ç³»ç»ŸçŠ¶æ€

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å…³é”®æ€§èƒ½æŒ‡æ ‡(KPI)
- **è¿æ¥æˆåŠŸç‡**: > 95%
- **å¿ƒè·³æ­£å¸¸ç‡**: > 98%  
- **å†…å®¹æ’­æ”¾æˆåŠŸç‡**: > 90%
- **å‘½ä»¤å“åº”æ—¶é—´**: < 5ç§’
- **å†…å­˜ä½¿ç”¨**: < 200MB
- **CPUä½¿ç”¨**: < 30%

### ç›‘æ§å»ºè®®
- å»ºç«‹è®¾å¤‡çŠ¶æ€ç›‘æ§é¢æ¿
- è®°å½•å…³é”®æ€§èƒ½æ•°æ®
- è®¾ç½®å¼‚å¸¸å‘Šè­¦é˜ˆå€¼
- å®šæœŸç”Ÿæˆè¿è¡ŒæŠ¥å‘Š

---

## ğŸ‰ éƒ¨ç½²å®Œæˆ

æ­å–œï¼æ‚¨å·²æˆåŠŸéƒ¨ç½²äº†æ™ºæ…§èåª’ä½“ç»ˆç«¯Androidåº”ç”¨ã€‚

**æ¥ä¸‹æ¥æ‚¨å¯ä»¥ï¼š**
1. ğŸ”§ æ ¹æ®å®é™…ç¯å¢ƒè°ƒæ•´é…ç½®å‚æ•°
2. ğŸ§ª ä½¿ç”¨æµ‹è¯•è„šæœ¬éªŒè¯å„é¡¹åŠŸèƒ½
3. ğŸ“Š å»ºç«‹ç›‘æ§å’Œç»´æŠ¤æœºåˆ¶
4. ğŸš€ æ‰©å±•æ›´å¤šä¸šåŠ¡åŠŸèƒ½

**æŠ€æœ¯æ”¯æŒï¼š**
- å‚è€ƒé¡¹ç›®README.mdè·å–è¯¦ç»†æŠ€æœ¯ä¿¡æ¯
- æŸ¥çœ‹MQTT_ANDROID_INTEGRATION.mdäº†è§£åè®®è§„èŒƒ
- ä½¿ç”¨logcatå‘½ä»¤è¿›è¡Œé—®é¢˜è¯Šæ–­
- è®¿é—®äº‘å¹³å°ç®¡ç†ç•Œé¢ç›‘æ§è®¾å¤‡çŠ¶æ€
